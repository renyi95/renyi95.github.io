<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.1.1"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css"><script src="https://cdn.jsdelivr.net/npm/echarts@5.1.1/dist/echarts.min.js"></script><script class="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"obsidianstar.cn",root:"/",images:"/images",scheme:"Pisces",version:"8.3.0",exturl:!1,sidebar:{position:"left",display:"always",padding:18,offset:12},copycode:!0,bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"fadeInDown",post_body:"fadeInDown",coll_header:"fadeInLeft",sidebar:"fadeInUp"}},prism:!1,i18n:{placeholder:"搜索...",empty:"没有找到任何搜索结果：${query}",hits_time:"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）",hits:"找到 ${hits} 个搜索结果"},path:"/search.xml",localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!0}}</script><meta name="description" content="缩小文件的搜索范围优化 Loader 配置由于 Loader 对文件的转换操作很耗时，所以需要让尽可能少的文件被 Loader 处理。我们可以通过以下 3 方面优化 Loader 配置：  优化正则匹配 通过 cacheDirectory 选项开启缓存 通过 include、exclude 来减少被处理的文件。实践如下：  项目原配置："><meta property="og:type" content="article"><meta property="og:title" content="Webpack优化实践"><meta property="og:url" content="https://obsidianstar.cn/2020/04/30/performance/webpack/index.html"><meta property="og:site_name" content="Rynes"><meta property="og:description" content="缩小文件的搜索范围优化 Loader 配置由于 Loader 对文件的转换操作很耗时，所以需要让尽可能少的文件被 Loader 处理。我们可以通过以下 3 方面优化 Loader 配置：  优化正则匹配 通过 cacheDirectory 选项开启缓存 通过 include、exclude 来减少被处理的文件。实践如下：  项目原配置："><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://obsidianstar.cn/images/source/report.png"><meta property="article:published_time" content="2020-04-29T16:00:00.000Z"><meta property="article:modified_time" content="2023-08-04T10:47:55.652Z"><meta property="article:author" content="Rynes"><meta property="article:tag" content="面试"><meta property="article:tag" content="性能优化"><meta property="article:tag" content="webpack"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://obsidianstar.cn/images/source/report.png"><link rel="canonical" href="https://obsidianstar.cn/2020/04/30/performance/webpack/"><script data-pjax class="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><title>Webpack优化实践 | Rynes</title><noscript><style>body{margin-top:2rem}.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header,.use-motion .sidebar{visibility:visible}.use-motion .footer,.use-motion .header,.use-motion .site-brand-container .toggle{opacity:initial}.use-motion .custom-logo-image,.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line{transform:scaleX(1)}.search-pop-overlay,.sidebar-nav{display:none}.sidebar-panel{display:block}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><h1 class="site-title">Rynes</h1><i class="logo-line"></i></a></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">314</span></a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">47</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">36</span></a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close" role="button"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class="search-result-icon"><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%BC%A9%E5%B0%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%90%9C%E7%B4%A2%E8%8C%83%E5%9B%B4"><span class="nav-number">1.</span> <span class="nav-text">缩小文件的搜索范围</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BC%98%E5%8C%96-Loader-%E9%85%8D%E7%BD%AE"><span class="nav-number">1.1.</span> <span class="nav-text">优化 Loader 配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BC%98%E5%8C%96-resolve-modules-%E9%85%8D%E7%BD%AE"><span class="nav-number">1.2.</span> <span class="nav-text">优化 resolve.modules 配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BC%98%E5%8C%96-resolve-alias-%E9%85%8D%E7%BD%AE"><span class="nav-number">1.3.</span> <span class="nav-text">优化 resolve.alias 配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BC%98%E5%8C%96-resolve-extensions-%E9%85%8D%E7%BD%AE"><span class="nav-number">1.4.</span> <span class="nav-text">优化 resolve.extensions 配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BC%98%E5%8C%96-resolve-noParse-%E9%85%8D%E7%BD%AE"><span class="nav-number">1.5.</span> <span class="nav-text">优化 resolve.noParse 配置</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%89%93%E5%8C%85%E6%97%B6-gzip-%E5%8E%8B%E7%BC%A9"><span class="nav-number">2.</span> <span class="nav-text">打包时 gzip 压缩</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#webpack-%E6%89%93%E5%8C%85%E7%94%9F%E6%88%90-gz-%E6%96%87%E4%BB%B6"><span class="nav-number">2.1.</span> <span class="nav-text">webpack 打包生成 gz 文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%9C%A8%E7%BA%BF-gzip-%E5%8E%8B%E7%BC%A9"><span class="nav-number">2.2.</span> <span class="nav-text">服务器在线 gzip 压缩</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%A4%E7%A7%8D%E6%96%B9%E6%A1%88%E7%9A%84%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="nav-number">2.3.</span> <span class="nav-text">两种方案的优缺点</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%87%8F%E5%B0%91%E5%86%97%E4%BD%99%E4%BB%A3%E7%A0%81"><span class="nav-number">3.</span> <span class="nav-text">减少冗余代码</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-HappyPack-%E5%A4%9A%E8%BF%9B%E7%A8%8B%E8%A7%A3%E6%9E%90%E5%92%8C%E5%A4%84%E7%90%86%E6%96%87%E4%BB%B6"><span class="nav-number">4.</span> <span class="nav-text">使用 HappyPack 多进程解析和处理文件</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#HappyPack-%E6%8F%92%E4%BB%B6%E5%AE%89%E8%A3%85%EF%BC%9A"><span class="nav-number">4.1.</span> <span class="nav-text">HappyPack 插件安装：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#webpack-base-conf-js-%E6%96%87%E4%BB%B6%E5%AF%B9-module-rules-%E8%BF%9B%E8%A1%8C%E9%85%8D%E7%BD%AE"><span class="nav-number">4.2.</span> <span class="nav-text">webpack.base.conf.js 文件对 module.rules 进行配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#webpack-prod-conf-js-%E6%96%87%E4%BB%B6%E8%BF%9B%E8%A1%8C%E9%85%8D%E7%BD%AE"><span class="nav-number">4.3.</span> <span class="nav-text">webpack.prod.conf.js 文件进行配置</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-ParallelUglifyPlugin-%E5%A4%9A%E8%BF%9B%E7%A8%8B%E5%8E%8B%E7%BC%A9%E4%BB%A3%E7%A0%81%E6%96%87%E4%BB%B6"><span class="nav-number">5.</span> <span class="nav-text">使用 ParallelUglifyPlugin 多进程压缩代码文件</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ParallelUglifyPlugin-%E6%8F%92%E4%BB%B6%E5%AE%89%E8%A3%85%EF%BC%9A"><span class="nav-number">5.1.</span> <span class="nav-text">ParallelUglifyPlugin 插件安装：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#webpack-prod-conf-js-%E6%96%87%E4%BB%B6%E8%BF%9B%E8%A1%8C%E9%85%8D%E7%BD%AE-1"><span class="nav-number">5.2.</span> <span class="nav-text">webpack.prod.conf.js 文件进行配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%9C%80%E8%A6%81%E6%B3%A8%E6%84%8F%E7%9A%84%E6%98%AF-webpack-%E5%8D%87%E7%BA%A7%E4%B9%8B%E5%90%8E-UglifyJsPlugin-%E6%A8%A1%E5%9D%97%E6%89%BE%E4%B8%8D%E5%88%B0%EF%BC%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E5%A6%82%E4%B8%8B%EF%BC%9A"><span class="nav-number">5.3.</span> <span class="nav-text">需要注意的是 webpack 升级之后 UglifyJsPlugin 模块找不到，解决方法如下：</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E8%87%AA%E5%8A%A8%E5%88%B7%E6%96%B0"><span class="nav-number">6.</span> <span class="nav-text">使用自动刷新</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%BC%80%E5%90%AF%E6%A8%A1%E5%9D%97%E7%83%AD%E6%9B%BF%E6%8D%A2"><span class="nav-number">7.</span> <span class="nav-text">开启模块热替换</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#CDN-%E5%8A%A0%E9%80%9F"><span class="nav-number">8.</span> <span class="nav-text">CDN 加速</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E6%AD%BB%E4%BB%A3%E7%A0%81%EF%BC%88tree-shaking%EF%BC%89"><span class="nav-number">9.</span> <span class="nav-text">删除死代码（tree shaking）</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%8F%90%E5%8F%96%E5%85%AC%E5%85%B1%E4%BB%A3%E7%A0%81"><span class="nav-number">10.</span> <span class="nav-text">提取公共代码</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%8C%89%E9%9C%80%E5%8A%A0%E8%BD%BD%E4%BB%A3%E7%A0%81"><span class="nav-number">11.</span> <span class="nav-text">按需加载代码</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BC%98%E5%8C%96-SourceMap"><span class="nav-number">12.</span> <span class="nav-text">优化 SourceMap</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#SourceMap-%E7%9A%84%E5%8F%AF%E9%80%89%E5%80%BC%E5%A6%82%E4%B8%8B"><span class="nav-number">12.1.</span> <span class="nav-text">SourceMap 的可选值如下</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%B7%E4%BD%93%E4%BD%BF%E7%94%A8"><span class="nav-number">12.2.</span> <span class="nav-text">具体使用</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%9E%84%E5%BB%BA%E7%BB%93%E6%9E%9C%E8%BE%93%E5%87%BA%E5%88%86%E6%9E%90"><span class="nav-number">13.</span> <span class="nav-text">构建结果输出分析</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E6%8F%90%E9%AB%98-webpack-%E7%9A%84%E6%9E%84%E5%BB%BA%E9%80%9F%E5%BA%A6"><span class="nav-number">14.</span> <span class="nav-text">如何提高 webpack 的构建速度</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person"><p class="site-author-name" itemprop="name">Rynes</p><div class="site-description" itemprop="description"></div></div><div class="site-state-wrap site-overview-item animated"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">314</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">36</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">47</span> <span class="site-state-item-name">标签</span></a></div></nav></div></div></div><div class="back-to-top animated" role="button" aria-label="返回顶部"><i class="fa fa-arrow-up"></i> <span>0%</span></div></div></aside><div class="sidebar-dimmer"></div></header><div class="reading-progress-bar"></div><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://obsidianstar.cn/2020/04/30/performance/webpack/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="Rynes"><meta itemprop="description" content=""></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Rynes"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">Webpack优化实践</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2020-04-30 00:00:00" itemprop="dateCreated datePublished" datetime="2020-04-30T00:00:00+08:00">2020-04-30</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2023-08-04 18:47:55" itemprop="dateModified" datetime="2023-08-04T18:47:55+08:00">2023-08-04</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/" itemprop="url" rel="index"><span itemprop="name">性能优化</span></a> </span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="far fa-eye"></i> </span><span class="post-meta-item-text">阅读次数：</span> <span id="busuanzi_value_page_pv"></span></span></div></div></header><div class="post-body" itemprop="articleBody"><h1 id="缩小文件的搜索范围"><a href="#缩小文件的搜索范围" class="headerlink" title="缩小文件的搜索范围"></a>缩小文件的搜索范围</h1><h2 id="优化-Loader-配置"><a href="#优化-Loader-配置" class="headerlink" title="优化 Loader 配置"></a>优化 Loader 配置</h2><p>由于 Loader 对文件的转换操作很耗时，所以需要让尽可能少的文件被 Loader 处理。我们可以通过以下 3 方面优化 Loader 配置：</p><ul><li>优化正则匹配</li><li>通过 cacheDirectory 选项开启缓存</li><li>通过 include、exclude 来减少被处理的文件。实践如下：</li></ul><p><strong>项目原配置：</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;test&quot;</span>: /\.js$/,</span><br><span class="line">  <span class="attr">&quot;loader&quot;</span>: &#x27;babel-loader&#x27;,</span><br><span class="line">  <span class="attr">&quot;include&quot;</span>: [resolve(&#x27;src&#x27;), resolve(&#x27;test&#x27;)]</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p><strong>优化后配置：</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="comment">// 1、如果项目源码中只有 js 文件，就不要写成/\.jsx?$/，以提升正则表达式的性能</span></span><br><span class="line">  <span class="attr">&quot;test&quot;</span>: /\.js$/,</span><br><span class="line">  <span class="comment">// 2、babel-loader 支持缓存转换出的结果，通过 cacheDirectory 选项开启</span></span><br><span class="line">  <span class="attr">&quot;loader&quot;</span>: &#x27;babel-loader?cacheDirectory&#x27;,</span><br><span class="line">  <span class="comment">// 3、只对项目根目录下的 src 目录中的文件采用 babel-loader</span></span><br><span class="line">  <span class="attr">&quot;include&quot;</span>: [resolve(&#x27;src&#x27;)]</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><h2 id="优化-resolve-modules-配置"><a href="#优化-resolve-modules-配置" class="headerlink" title="优化 resolve.modules 配置"></a>优化 resolve.modules 配置</h2><p><code>resolve.modules</code> 用于配置 Webpack 去哪些目录下寻找第三方模块。resolve.modules 的默认值是<code>［node modules］</code>，含义是先去当前目录的/node modules 目录下去找我们想找的模块，如果没找到，就去上一级目录../node modules 中找，再没有就去../ .. /node modules 中找，以此类推，这和 Node.js 的模块寻找机制很相似。当安装的第三方模块都放在项目根目录的./node modules 目录下时，就没有必要按照默认的方式去一层层地寻找，可以指明存放第三方模块的绝对路径，以减少寻找。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  configureWebpack: &#123;</span><br><span class="line">    resolve: &#123;</span><br><span class="line">      <span class="comment">// 使用绝对路径指明第三方模块存放的位置，以减少搜索步骤</span></span><br><span class="line">      modules: [path.resolve(__dirname, <span class="string">&quot;node_modules&quot;</span>)]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="优化-resolve-alias-配置"><a href="#优化-resolve-alias-配置" class="headerlink" title="优化 resolve.alias 配置"></a>优化 resolve.alias 配置</h2><p><code>resolve.alias</code> 配置项通过别名来将原导入路径映射成一个新的导入路径。<br>如项目中的配置使用：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  configureWebpack: &#123;</span><br><span class="line">    resolve: &#123;</span><br><span class="line">      alias: &#123;</span><br><span class="line">        <span class="string">&quot;@&quot;</span>: resolve(<span class="string">&quot;src&quot;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过以上的配置，引用 src 底下的 common.js 文件，就可以直接这么写</span></span><br><span class="line"><span class="keyword">import</span> common <span class="keyword">from</span> <span class="string">&quot;@/common.js&quot;</span>;</span><br></pre></td></tr></table></figure><h2 id="优化-resolve-extensions-配置"><a href="#优化-resolve-extensions-配置" class="headerlink" title="优化 resolve.extensions 配置"></a>优化 resolve.extensions 配置</h2><p>在导入语句没带文件后缀时，Webpack 会在自动带上后缀后去尝试询问文件是否存在。默认是：<code>extensions:[&#39;. js &#39;,&#39;. json &#39;]</code> 。也就是说，当遇到 require(‘. /data’)这样的导入语句时，Webpack 会先去寻找./data .js 文件，如果该文件不存在，就去寻找./data.json 文件，如果还是找不到就报错。如果这个列表越长，或者正确的后缀越往后，就会造成尝试的次数越多，所以 <code>resolve.extensions</code> 的配置也会影响到构建的性能。</p><p><strong>优化措施：</strong></p><ul><li>后缀尝试列表要尽可能小，不要将项目中不可能存在的情况写到后缀尝试列表中。</li><li>频率出现最高的文件后缀要优先放在最前面，以做到尽快退出寻找过程。</li><li>在源码中写导入语句时，要尽可能带上后缀，从而可以避免寻找过程。例如在确定的情况下将 require(’. /data ’)写成 require(’. /data.json ’)，可以结合 enforceExtension 和 enforceModuleExtension 开启使用来强制开发者遵守这条优化**</li></ul><h2 id="优化-resolve-noParse-配置"><a href="#优化-resolve-noParse-配置" class="headerlink" title="优化 resolve.noParse 配置"></a>优化 resolve.noParse 配置</h2><p>noParse 配置项可以让 Webpack 忽略对部分没采用模块化的文件的递归解析和处理，这 样做的好处是能提高构建性能。原因是一些库如 jQuery、ChartJS 庞大又没有采用模块化标准，让 Webpack 去解析这些文件既耗时又没有意义。noParse 是可选的配置项，类型需要是 RegExp 、[RegExp]、function 中的一种。例如，若想要忽略 jQuery 、ChartJS ，则优化配置如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  configureWebpack: &#123;</span><br><span class="line">    resolve: &#123;</span><br><span class="line">      <span class="comment">// 使用正则表达式</span></span><br><span class="line">      noParse: <span class="regexp">/jquerylchartjs/</span></span><br><span class="line">      <span class="comment">// 或使用函数，从 Webpack3.0.0 开始支持</span></span><br><span class="line">      <span class="comment">// noParse: (content) =&gt; &#123;</span></span><br><span class="line">      <span class="comment">//   // 返回 true 或 false</span></span><br><span class="line">      <span class="comment">//   return /jquery|chartjs/.test(content);</span></span><br><span class="line">      <span class="comment">// &#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h1 id="打包时-gzip-压缩"><a href="#打包时-gzip-压缩" class="headerlink" title="打包时 gzip 压缩"></a>打包时 gzip 压缩</h1><h2 id="webpack-打包生成-gz-文件"><a href="#webpack-打包生成-gz-文件" class="headerlink" title="webpack 打包生成 gz 文件"></a>webpack 打包生成 gz 文件</h2><ol><li>安装插件（compression-webpack-plugin）：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install compression-webpack-plugin --save-dev</span><br></pre></td></tr></table></figure><ol start="2"><li>vue.config.js 文件进行 webpack 配置</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> CompressionWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;compression-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  configureWebpack: <span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</span><br><span class="line">    config.plugins.push(</span><br><span class="line">      <span class="keyword">new</span> CompressionWebpackPlugin(&#123;</span><br><span class="line">        <span class="comment">// 正在匹配需要压缩的文件后缀</span></span><br><span class="line">        test: <span class="regexp">/\.(js|css|svg|woff|ttf|json|html)$/</span>,</span><br><span class="line">        <span class="comment">// 大于10kb的会压缩</span></span><br><span class="line">        threshold: <span class="number">10240</span></span><br><span class="line">        <span class="comment">// 其余配置查看 compression-webpack-plugin</span></span><br><span class="line">      &#125;)</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ol start="3"><li>nginx 开启 gzip</li></ol><blockquote><p>浏览器请求 xx.js/css 等文件时，服务器返回对应的 xxx.js.gz 文件，所以还需要在服务器配置一个属性，以期望它能正常返回我们需要的 gz 文件</p></blockquote><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">  <span class="attribute">include</span>       mime.types;</span><br><span class="line">  <span class="attribute">default_type</span>  application/octet-stream;</span><br><span class="line">  <span class="attribute">sendfile</span>        <span class="literal">on</span>;</span><br><span class="line">  <span class="comment">#tcp_nopush     on;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">#keepalive_timeout  0;</span></span><br><span class="line">  <span class="attribute">keepalive_timeout</span>  <span class="number">65</span>;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">gzip_static</span> <span class="literal">on</span>; <span class="comment"># 开启gzip 静态加载本地的gz文件</span></span><br><span class="line"></span><br><span class="line">  <span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>       <span class="number">8462</span>;</span><br><span class="line">    <span class="attribute">server_name</span>  localhost;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">        <span class="attribute">root</span>   dist;</span><br><span class="line">        <span class="attribute">index</span>  index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="attribute">error_page</span>   <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span>  /50x.html;</span><br><span class="line">    <span class="attribute">location</span> = /50x.html &#123;</span><br><span class="line">        <span class="attribute">root</span>   html;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="服务器在线-gzip-压缩"><a href="#服务器在线-gzip-压缩" class="headerlink" title="服务器在线 gzip 压缩"></a>服务器在线 gzip 压缩</h2><blockquote><p>前端不用进行任何配置，也不用 webpack 生成 gz 文件，服务器进行处理<br>响应头中会携带 gzip 压缩配置，每次请求 xx.js 文件，服务器都会进行实时压缩。</p></blockquote><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">server</span><br><span class="line">&#123;</span><br><span class="line">  server_name www.zuoguoqing.com;</span><br><span class="line"></span><br><span class="line">  <span class="comment"># 开启gzip</span></span><br><span class="line">  gzip on;</span><br><span class="line">  gzip_vary on;</span><br><span class="line">  gzip_min_length <span class="number">1000</span>;</span><br><span class="line">  gzip_comp_level <span class="number">2</span>;</span><br><span class="line">  gzip_types text<span class="regexp">/plain text/</span>css text<span class="regexp">/xml text/</span>javascript application<span class="regexp">/x-javascript application/</span>xml image<span class="regexp">/jpeg image/gi</span>f image<span class="regexp">/png application/</span>javascript;</span><br><span class="line"></span><br><span class="line">  location / &#123;</span><br><span class="line">    <span class="comment"># root   html;</span></span><br><span class="line">    <span class="comment"># index  index.html index.htm;</span></span><br><span class="line">    proxy_pass http:<span class="regexp">//</span><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">3000</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="两种方案的优缺点"><a href="#两种方案的优缺点" class="headerlink" title="两种方案的优缺点"></a>两种方案的优缺点</h2><ol><li>webpack 打包，然后直接使用静态的 gz，缺点就是打包后文件体积太大，但是不耗服务器性能；</li><li>使用 nginx 在线 gzip，缺点就是耗性能，需要实时压缩，但是 vue 打包后的文件体积小。</li></ol><p>如果想有 gz 文件的时候进行静态压缩，不存在 gz 文件的时候进行在线压缩而不是加载源文件，nginx 配置时两种配置都写上即可</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gzip <span class="keyword">on</span>;</span><br><span class="line">gzip_static <span class="keyword">on</span>;</span><br><span class="line">gzip_comp_level <span class="number">2</span>;</span><br><span class="line">gzip_types <span class="built_in">text</span>/plain <span class="built_in">text</span>/html <span class="built_in">text</span>/css <span class="built_in">application</span>/x-javascript <span class="built_in">text</span>/xml <span class="built_in">application</span>/xml <span class="built_in">application</span>/xml+rss <span class="built_in">text</span>/javascript;</span><br></pre></td></tr></table></figure><p>gzip_static 的优先级高，会先加载静态 gz 文件，当同目录下不存在此文件的时候，会执行在线压缩的命令。</p><p><strong>如何区分使用了静态加载还是在线压缩？</strong></p><p>响应头的 Content-Edcoding:gzip 表示 gzip 压缩已经生效，而 Etag 中只有简单字符表示静态资源加载，而前面带 W/ 表示启动了在线压缩</p><h1 id="减少冗余代码"><a href="#减少冗余代码" class="headerlink" title="减少冗余代码"></a>减少冗余代码</h1><p><code>babel-plugin-transform-runtime</code> 是 <code>Babel</code> 官方提供的一个插件，作用是减少冗余的代码 。 Babel 在将 ES6 代码转换成 ES5 代码时，通常需要一些由 ES5 编写的辅助函数来完成新语法的实现，例如在转换 class extent 语法时会在转换后的 ES5 代码里注入 extent 辅助函数用于实现继承。babel-plugin-transform-runtime 会将相关辅助函数进行替换成导入语句，从而减小 babel 编译出来的代码的文件大小。</p><h1 id="使用-HappyPack-多进程解析和处理文件"><a href="#使用-HappyPack-多进程解析和处理文件" class="headerlink" title="使用 HappyPack 多进程解析和处理文件"></a>使用 HappyPack 多进程解析和处理文件</h1><p>由于有大量文件需要解析和处理，所以构建是文件读写和计算密集型的操作，特别是当文件数量变多后，Webpack 构建慢的问题会显得更为严重。运行在 Node.之上的 Webpack 是单线程模型的，也就是说 Webpack 需要一个一个地处理任务，不能同时处理多个任务。Happy Pack ( <a target="_blank" rel="noopener" href="https://github.com/amireh/hap">https://github.com/amireh/hap</a>… ) 就能让 Webpack 做到这一点，它将任务分解给多个子进程去并发执行，子进程处理完后再将结果发送给主进程。<br>项目中 HappyPack 使用配置：</p><h2 id="HappyPack-插件安装："><a href="#HappyPack-插件安装：" class="headerlink" title="HappyPack 插件安装："></a>HappyPack 插件安装：</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i -D happypack</span><br></pre></td></tr></table></figure><h2 id="webpack-base-conf-js-文件对-module-rules-进行配置"><a href="#webpack-base-conf-js-文件对-module-rules-进行配置" class="headerlink" title="webpack.base.conf.js 文件对 module.rules 进行配置"></a>webpack.base.conf.js 文件对 module.rules 进行配置</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  rules: [</span><br><span class="line">    &#123;</span><br><span class="line">      test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">      <span class="comment">// 将对.js 文件的处理转交给 id 为 babel 的HappyPack实例</span></span><br><span class="line">      use: [<span class="string">&quot;happypack/loader?id=babel&quot;</span>],</span><br><span class="line">      include: [resolve(<span class="string">&quot;src&quot;</span>), resolve(<span class="string">&quot;test&quot;</span>), resolve(<span class="string">&quot;node_modules/webpack-dev-server/client&quot;</span>)],</span><br><span class="line">      <span class="comment">// 排除第三方插件</span></span><br><span class="line">      exclude: path.resolve(__dirname, <span class="string">&quot;node_modules&quot;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      test: <span class="regexp">/\.vue$/</span>,</span><br><span class="line">      use: [<span class="string">&quot;happypack/loader?id=vue&quot;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="webpack-prod-conf-js-文件进行配置"><a href="#webpack-prod-conf-js-文件进行配置" class="headerlink" title="webpack.prod.conf.js 文件进行配置"></a>webpack.prod.conf.js 文件进行配置</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> HappyPack = <span class="built_in">require</span>(<span class="string">&quot;happypack&quot;</span>);</span><br><span class="line"><span class="comment">// 构造出共享进程池，在进程池中包含 5 个子进程</span></span><br><span class="line"><span class="keyword">const</span> HappyPackThreadPool = HappyPack.ThreadPool(&#123; <span class="attr">size</span>: <span class="number">5</span> &#125;);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> HappyPack(&#123;</span><br><span class="line">      <span class="comment">// 用唯一的标识符 id，来代表当前的 HappyPack 是用来处理一类特定的文件</span></span><br><span class="line">      id: <span class="string">&quot;vue&quot;</span>,</span><br><span class="line">      loaders: [</span><br><span class="line">        &#123;</span><br><span class="line">          loader: <span class="string">&quot;vue-loader&quot;</span>,</span><br><span class="line">          options: vueLoaderConfig</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      threadPool: HappyPackThreadPool</span><br><span class="line">    &#125;),</span><br><span class="line"></span><br><span class="line">    <span class="keyword">new</span> HappyPack(&#123;</span><br><span class="line">      <span class="comment">// 用唯一的标识符id，来代表当前的HappyPack是用来处理一类特定的文件</span></span><br><span class="line">      id: <span class="string">&quot;babel&quot;</span>,</span><br><span class="line">      <span class="comment">// 如何处理.js文件，用法和Loader配置中一样</span></span><br><span class="line">      loaders: [<span class="string">&quot;babel-loader?cacheDirectory&quot;</span>],</span><br><span class="line">      threadPool: HappyPackThreadPool</span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h1 id="使用-ParallelUglifyPlugin-多进程压缩代码文件"><a href="#使用-ParallelUglifyPlugin-多进程压缩代码文件" class="headerlink" title="使用 ParallelUglifyPlugin 多进程压缩代码文件"></a>使用 <code>ParallelUglifyPlugin</code> 多进程压缩代码文件</h1><p>由于压缩 JavaScript 代码时，需要先将代码解析成用 Object 抽象表示的 AST 语法树，再去应用各种规则分析和处理 AST ，所以导致这个过程的计算量巨大，耗时非常多。当 Webpack 有多个 JavaScript 文件需要输出和压缩时，原本会使用 UglifyJS 去一个一个压缩再输出，但是 ParallelUglifyPlugin 会开启多个子进程，将对多个文件的压缩工作分配给多个子进程去完成，每个子进程其实还是通过 UglifyJS 去压缩代码，但是变成了并行执行。所以 ParallelUglify Plugin 能更快地完成对多个文件的压缩工作。</p><h2 id="ParallelUglifyPlugin-插件安装："><a href="#ParallelUglifyPlugin-插件安装：" class="headerlink" title="ParallelUglifyPlugin 插件安装："></a>ParallelUglifyPlugin 插件安装：</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i -D webpack-parallel-uglify-plugin</span><br></pre></td></tr></table></figure><h2 id="webpack-prod-conf-js-文件进行配置-1"><a href="#webpack-prod-conf-js-文件进行配置-1" class="headerlink" title="webpack.prod.conf.js 文件进行配置"></a>webpack.prod.conf.js 文件进行配置</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ParallelUglifyPlugin = <span class="built_in">require</span>(<span class="string">&quot;webpack-parallel-uglify-plugin&quot;</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> ParallelUglifyPlugin(&#123;</span><br><span class="line">      cacheDir: <span class="string">&quot;.cache/&quot;</span>,</span><br><span class="line">      uglifyJs: &#123;</span><br><span class="line">        compress: &#123;</span><br><span class="line">          warnings: <span class="literal">false</span></span><br><span class="line">        &#125;,</span><br><span class="line">        sourceMap: <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="需要注意的是-webpack-升级之后-UglifyJsPlugin-模块找不到，解决方法如下："><a href="#需要注意的是-webpack-升级之后-UglifyJsPlugin-模块找不到，解决方法如下：" class="headerlink" title="需要注意的是 webpack 升级之后 UglifyJsPlugin 模块找不到，解决方法如下："></a>需要注意的是 webpack 升级之后 UglifyJsPlugin 模块找不到，解决方法如下：</h2><p><code>原：</code></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;uglifyjs-webpack-plugin&quot;</span>: <span class="string">&quot;^2.1.2&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> UglifyJsPlugin = <span class="built_in">require</span>(<span class="string">&quot;uglifyjs-webpack-plugin&quot;</span>);</span><br></pre></td></tr></table></figure><p><code>替换为：</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">config.plugins = [...config.plugins, ...plugins];</span><br><span class="line">config.optimization.minimizer[<span class="number">0</span>].options.terserOptions.compress.drop_console = <span class="literal">true</span>; <span class="comment">// 删除console</span></span><br><span class="line">config.optimization.minimizer[<span class="number">0</span>].options.terserOptions.compress.drop_debugger = <span class="literal">true</span>; <span class="comment">// 删除deubgger</span></span><br></pre></td></tr></table></figure><h1 id="使用自动刷新"><a href="#使用自动刷新" class="headerlink" title="使用自动刷新"></a>使用自动刷新</h1><p>借助自动化的手段，在监听到本地源码文件发生变化时，自动重新构建出可运行的代码后再控制浏览器刷新。Webpack 将这些功能都内置了，并且提供了多种方案供我们选择。<br>项目中自动刷新的配置：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  devServer: &#123;</span><br><span class="line">    watchOptions: &#123;</span><br><span class="line">      <span class="comment">// 不监听的文件或文件夹，支持正则匹配</span></span><br><span class="line">      ignored: <span class="regexp">/node_modules/</span>,</span><br><span class="line">      <span class="comment">// 监听到变化后等 300ms 再去执行动作</span></span><br><span class="line">      aggregateTimeout: <span class="number">300</span>,</span><br><span class="line">      <span class="comment">// 默认每秒询问 1000 次</span></span><br><span class="line">      poll: <span class="number">1000</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>相关优化措施：</strong></p><ul><li>配置忽略一些不监听的一些文件，如：node_modules。</li><li>watchOptions.aggregateTirneout 的值越大性能越好，因为这能降低重新构建的频率。</li><li>watchOptions.poll 的值越小越好，因为这能降低检查的频率。</li></ul><h1 id="开启模块热替换"><a href="#开启模块热替换" class="headerlink" title="开启模块热替换"></a>开启模块热替换</h1><blockquote><p>DevServer 还支持一种叫做模块热替换（ Hot Module Replacement ）的技术可在不刷新整个网页的情况下做到超灵敏实时预览。原理是在一个源码发生变化时，只需重新编译发生变化的模块，再用新输出的模块替换掉浏览器中对应的老模块 。模块热替换技术在很大程度上提升了开发效率和体验 。</p></blockquote><p>项目中模块热替换的配置：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  devServer: &#123;</span><br><span class="line">    hot: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> webpack.HotModuleReplacementPlugin(),</span><br><span class="line">    <span class="comment">// 显示被替换模块的名称</span></span><br><span class="line">    <span class="keyword">new</span> webpack.NamedModulesPlugin() <span class="comment">// HMR shows correct file names</span></span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h1 id="CDN-加速"><a href="#CDN-加速" class="headerlink" title="CDN 加速"></a>CDN 加速</h1><p>将引用的静态资源修改为 CDN 上对应的路径，可以利用 webpack 对 于 output 参数和 loader 的 publicpath 参数来修改资源路径</p><h1 id="删除死代码（tree-shaking）"><a href="#删除死代码（tree-shaking）" class="headerlink" title="删除死代码（tree shaking）"></a>删除死代码（tree shaking）</h1><blockquote><p>css 需要使用 Purify-CSS</p></blockquote><h1 id="提取公共代码"><a href="#提取公共代码" class="headerlink" title="提取公共代码"></a>提取公共代码</h1><p>如果每个页面的代码都将这些公共的部分包含进去，则会造成以下问题 ：</p><ul><li>相同的资源被重复加载，浪费用户的流量和服务器的成本。</li><li>每个页面需要加载的资源太大，导致网页首屏加载缓慢，影响用户体验。<br>如果将多个页面的公共代码抽离成单独的文件，就能优化以上问题 。Webpack 内置了专门用于提取多个 Chunk 中的公共部分的插件 CommonsChunkPlugin。</li></ul><p>项目中 <code>CommonsChunkPlugin</code> 的配置：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  configureWebpack: &#123;</span><br><span class="line">    plugins: [</span><br><span class="line">      <span class="comment">// 所有在 package.json 里面依赖的包，都会被打包进 vendor.js 这个文件中。</span></span><br><span class="line">      <span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</span><br><span class="line">        name: <span class="string">&quot;vendor&quot;</span>,</span><br><span class="line">        minChunks: <span class="function"><span class="keyword">function</span> (<span class="params">module, count</span>) </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="built_in">module</span>.resource &amp;&amp; <span class="regexp">/\.js$/</span>.test(<span class="built_in">module</span>.resource) &amp;&amp; <span class="built_in">module</span>.resource.indexOf(path.join(__dirname, <span class="string">&quot;../node_modules&quot;</span>)) === <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;),</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 抽取出代码模块的映射关系</span></span><br><span class="line">      <span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</span><br><span class="line">        name: <span class="string">&quot;manifest&quot;</span>,</span><br><span class="line">        chunks: [<span class="string">&quot;vendor&quot;</span>]</span><br><span class="line">      &#125;)</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h1 id="按需加载代码"><a href="#按需加载代码" class="headerlink" title="按需加载代码"></a>按需加载代码</h1><p>通过 vue 写的单页应用时，可能会有很多的路由引入。当打包构建的时候，javascript 包会变得非常大，影响加载。如果我们能把不同路由对应的组件分割成不同的代码块，然后当路由被访问的时候才加载对应的组件，这样就更加高效了。这样会大大提高首屏显示的速度，但是可能其他的页面的速度就会降下来。<br>项目中路由按需加载（懒加载）的配置：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Foo = <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&quot;./Foo.vue&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter(&#123;</span><br><span class="line">  routes: [&#123; <span class="attr">path</span>: <span class="string">&quot;/foo&quot;</span>, <span class="attr">component</span>: Foo &#125;]</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h1 id="优化-SourceMap"><a href="#优化-SourceMap" class="headerlink" title="优化 SourceMap"></a>优化 SourceMap</h1><p>source map 是将编译、打包、压缩后的代码映射回源代码的过程。打包压缩后的代码不具备良好的可读性，想要调试源码就需要 soucre map</p><blockquote><p>我们在项目进行打包后，会将开发中的多个文件代码打包到一个文件中，并且经过压缩，去掉多余的空格，且 babel 编译化后，最终会用于线上环境，那么这样处理后的代码和源代码会有很大的差别，当有 bug 的时候，我们只能定位到压缩处理后的代码位置，无法定位到开发环境中的代码，对于开发不好调式，因此 sourceMap 出现了，它就是为了解决不好调式代码问题的。</p></blockquote><h2 id="SourceMap-的可选值如下"><a href="#SourceMap-的可选值如下" class="headerlink" title="SourceMap 的可选值如下"></a>SourceMap 的可选值如下</h2><p>开发环境推荐：<code>cheap-module-eval-source-map</code><br>生产环境推荐：<code>cheap-module-source-map</code></p><p><strong>原因如下：</strong><br>源代码中的列信息是没有任何作用，因此我们打包后的文件不希望包含列相关信息，只有行信息能建立打包前后的依赖关系。因此不管是开发环境或生产环境，我们都希望添加 cheap 的基本类型来忽略打包前后的列信息。<br>不管是开发环境还是正式环境，我们都希望能定位到 bug 的源代码具体的位置，比如说某个 vue 文件报错了，我们希望能定位到具体的 vue 文件，因此我们也需要 module 配置。<br>我们需要生成 map 文件的形式，因此我们需要增加 source-map 属性。<br>我们介绍了 eval 打包代码的时候，知道 eval 打包后的速度非常快，因为它不生成 map 文件，但是可以对 eval 组合使用 eval-source-map 使用会将 map 文件以 DataURL 的形式存在打包后的 js 文件中。在正式环境中不要使用 eval-source-map, 因为它会增加文件的大小，但是在开发环境中，可以试用下，因为他们打包的速度很快</p><h2 id="具体使用"><a href="#具体使用" class="headerlink" title="具体使用"></a>具体使用</h2><p>map 文件只要不打开开发者工具，浏览器是不会加载的，线上环境一般有三种处理方案</p><ol><li><code>hidden-source-map</code>：借助第三方错误监控平台 Sentry 使用</li><li><code>nosources-source-map</code>：只会显示具体行数以及查看源代码的错误栈，安全性 比 sourcemap 要高一些</li><li><code>sourcemap</code>：通过 nginx 设置将 <code>.map</code> 文件只对白名单开放(公司内网)</li></ol><p><strong>注意：</strong>避免在生产中使用 <code>inline-</code> 和 <code>eval-</code>，因为它们会增加 bundle 体积大小，并降 低整体性能</p><h1 id="构建结果输出分析"><a href="#构建结果输出分析" class="headerlink" title="构建结果输出分析"></a>构建结果输出分析</h1><p>Webpack 输出的代码可读性非常差而且文件非常大，让我们非常头疼。为了更简单、直观地分析输出结果，社区中出现了许多可视化分析工具。这些工具以图形的方式将结果更直观地展示出来，让我们快速了解问题所在。接下来讲解 vue 项目中用到的分析工具：<code>webpack-bundle-analyzer</code>。<br>项目中在 <code>webpack.prod.conf.js</code> 进行配置：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (config.build.bundleAnalyzerReport) &#123;</span><br><span class="line">  <span class="keyword">var</span> BundleAnalyzerPlugin = <span class="built_in">require</span>(<span class="string">&quot;webpack-bundle-analyzer&quot;</span>).BundleAnalyzerPlugin;</span><br><span class="line">  webpackConfig.plugins.push(<span class="keyword">new</span> BundleAnalyzerPlugin());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>执行 <code>npm run build --report</code> 后生成分析报告如下：<br><img src="/images/source/report.png"></p><h1 id="如何提高-webpack-的构建速度"><a href="#如何提高-webpack-的构建速度" class="headerlink" title="如何提高 webpack 的构建速度"></a>如何提高 webpack 的构建速度</h1><p>在多入口情况下，使用 CommonsChunkPlugin 来提取公共代码</p><ol><li>通过 externals 配置来提取常用库</li><li>利用 DllPlugin 和 DllReferencePlugin 预编译资源模块 通过 DllPlugin 来对那些我们引用但是绝对不会修改的 npm 包来进行预编译，再通过 DllReferencePlugin 将预编译的模块加载进来。</li><li>使用 Happypack 实现多线程加速编译</li><li>使用 webpack-uglify-parallel 来提升 uglifyPlugin 的压缩速度。 原理上 webpack-uglify-parallel 采用了多核并行压缩来提升压缩速度</li><li>使用 Tree-shaking 和 Scope Hoisting 来剔除多余代码</li></ol></div><footer class="post-footer"><div class="reward-container"><div></div><button onclick='document.querySelector(".post-reward").classList.toggle("active")'>赞赏</button><div class="post-reward"><div><img src="/images/wechat.jpg" alt="Rynes 微信"> <span>微信</span></div><div><img src="/images/alipay.jpg" alt="Rynes 支付宝"> <span>支付宝</span></div></div></div><div class="post-copyright"><ul><li class="post-copyright-author"><strong>本文作者： </strong>Rynes</li><li class="post-copyright-link"><strong>本文链接：</strong> <a href="https://obsidianstar.cn/2020/04/30/performance/webpack/" title="Webpack优化实践">https://obsidianstar.cn/2020/04/30/performance/webpack/</a></li></ul></div><div class="post-tags"><a href="/tags/%E9%9D%A2%E8%AF%95/" rel="tag"><i class="fa fa-tag"></i> 面试</a> <a href="/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/" rel="tag"><i class="fa fa-tag"></i> 性能优化</a> <a href="/tags/webpack/" rel="tag"><i class="fa fa-tag"></i> webpack</a></div><div class="post-nav"><div class="post-nav-item"><a href="/2020/04/30/vue/watch/" rel="prev" title="watch 深度监听的优化"><i class="fa fa-chevron-left"></i> watch 深度监听的优化</a></div><div class="post-nav-item"><a href="/2020/05/21/cordova/intro/" rel="next" title="cordova入门">cordova入门 <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><script>window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }</script></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2024</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">Rynes</span></div><div class="busuanzi-count"><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i> </span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span> </span></span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动</div></div></footer><script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@next-theme/pjax@0.4.0/pjax.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script>var pjax = new Pjax({
  selectors: [
    'head title',
    '.page-configurations',
    '.main-inner',
    '.post-toc-wrap',
    '.languages',
    '.pjax'
  ],
  analytics: false,
  cacheBust: false,
  scrollRestoration: false,
  scrollTo: !CONFIG.bookmark.enable
});

document.addEventListener('pjax:success', () => {
  pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  const hasTOC = document.querySelector('.post-toc');
  document.querySelector('.sidebar-inner').classList.toggle('sidebar-nav-active', hasTOC);
  document.querySelector(hasTOC ? '.sidebar-nav-toc' : '.sidebar-nav-overview').click();
  NexT.utils.updateSidebarPosition();
});</script><script src="/js/local-search.js"></script><script data-pjax>if (document.querySelectorAll('.pdf-container').length) {
  NexT.utils.getScript('https://cdn.jsdelivr.net/npm/pdfobject@2.2.5/pdfobject.min.js', () => {
    document.querySelectorAll('.pdf-container').forEach(element => {
      PDFObject.embed(element.dataset.target, element, {
        pdfOpenParams: {
          navpanes : 0,
          toolbar  : 0,
          statusbar: 0,
          pagemode : 'thumbs',
          view     : 'FitH'
        },
        PDFJS_URL: '/lib/pdf/web/viewer.html',
        height   : element.dataset.height
      });
    });
  }, window.PDFObject);
}</script><script data-pjax>var mermaidElements = document.querySelectorAll('.mermaid');
if (mermaidElements.length) {
  NexT.utils.getScript('https://cdn.jsdelivr.net/npm/mermaid@8.9.2/dist/mermaid.min.js', () => {
    mermaidElements.forEach(element => {
      const newElement = document.createElement('div');
      newElement.innerHTML = element.innerHTML;
      newElement.className = element.className;
      element.parentNode.replaceChild(newElement, element);
    });

    mermaid.init({
      theme    : 'forest',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    }, '.mermaid');
  }, window.mermaid);
}</script><script data-pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="pjax"></div></body></html>